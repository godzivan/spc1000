ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 ;==============================================================================
                              2 ;   Floppy Disk access code for SPC-1000
                              3 ;
                              4 ;           sd725.s
                              5 ;                                   By meeso.kim
                              6 ;==============================================================================
                              7 
                              8 	.module	sd725
                              9 	.area	_CODE
                             10 	
                     0000    11 SDINIT		= 0
                     0001    12 SDWRITE		= 1
                     0002    13 SDREAD		= 2
                     0003    14 SDSEND  	= 3
                     0004    15 SDCOPY		= 4
                     0005    16 SDFORMAT	= 5
                     0006    17 SDSTATUS	= 6
                     0007    18 SDDRVSTS	= 7
                     0008    19 SDRAMTST	= 8
                     0009    20 SDTRANS2	= 9
                     000A    21 SDNOACT		= 0xA
                     000B    22 SDTRANS1	= 0xB
                     000C    23 SDRCVE		= 0xC
                     000D    24 SDGO		= 0xD
                     000E    25 SDLOAD		= 0xE
                     000F    26 SDSAVE		= 0xF
                     0010    27 SDLDNGO		= 0x10	
                     0AD5    28 CLR2		= 0xad5
                             29 		
   0000                      30 _chkfdd::
   0000 DD E5         [15]   31 	push ix
   0002 DD 21 02 00   [14]   32 	ld ix,#2
   0006 DD 39         [15]   33 	add ix,sp
   0008 DD 7E 00      [19]   34 	ld a,(ix)
                             35 	
   000B DD E1         [14]   36 	pop ix
   000D C9            [10]   37 	ret
                             38 	
   000E                      39 _sd_init::
   000E                      40 CHECKFDD:
   000E 06 C0         [ 7]   41 	LD	B,#0xC0         	
   0010 0E 02         [ 7]   42   	LD	C,#0x02         
   0012 AF            [ 4]   43    	XOR	A             	
   0013 ED 79         [12]   44   	OUT	(C),A         	
   0015 0E 00         [ 7]   45    	LD	C,#0         	
   0017 ED 79         [12]   46    	OUT	(C),A         	
   0019 16 00         [ 7]   47 	ld d, #SDINIT
   001B CD 09 01      [17]   48 	call sendcmd
   001E 16 07         [ 7]   49 	ld d, #SDDRVSTS
   0020 CD 09 01      [17]   50 	call sendcmd
   0023 CD 40 01      [17]   51 	call recvdata
   0026 7A            [ 4]   52 	ld a, d
   0027 E6 10         [ 7]   53 	and #0x10
   0029 28 E3         [12]   54 	jr z, CHECKFDD
   002B C9            [10]   55 	ret
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                             56 
   002C                      57 _sd_read::
   002C C5            [11]   58 	push bc
   002D DD E5         [15]   59 	push ix
   002F DD 21 06 00   [14]   60 	ld ix,#6
   0033 DD 39         [15]   61 	add ix,sp
   0035 16 02         [ 7]   62 	ld d, #SDREAD
   0037 CD 09 01      [17]   63 	call sendcmd
   003A DD 56 00      [19]   64 	ld d,0(ix)
   003D CD 11 01      [17]   65 	call senddata
   0040 DD 56 01      [19]   66 	ld d,1(ix)
   0043 CD 11 01      [17]   67 	call senddata
   0046 DD 56 02      [19]   68 	ld d,2(ix)
   0049 CD 11 01      [17]   69 	call senddata
   004C DD 56 03      [19]   70 	ld d,3(ix)
   004F CD 11 01      [17]   71 	call senddata
   0052 16 03         [ 7]   72 	ld d, #SDSEND
   0054 CD 09 01      [17]   73 	call sendcmd
   0057 DD 6E 04      [19]   74 	ld l,4(ix)
   005A DD 66 05      [19]   75 	ld h,5(ix)
   005D DD 46 00      [19]   76 	ld b,0(ix) 
   0060 0E 00         [ 7]   77 	ld c,#0x0
   0062                      78 RDLOOP:
   0062 CD 40 01      [17]   79 	call recvdata
   0065 72            [ 7]   80 	ld (hl), d
   0066 23            [ 6]   81 	inc hl
   0067 0B            [ 6]   82 	dec bc
   0068 78            [ 4]   83 	ld  a, b
   0069 B1            [ 4]   84 	or  c
   006A 20 F6         [12]   85 	jr nz, RDLOOP
   006C DD E1         [14]   86 	pop ix
   006E C1            [10]   87 	pop bc
   006F C9            [10]   88 	ret
                             89 	
   0070                      90 _sd_write::
   0070 C5            [11]   91 	push bc
   0071 DD E5         [15]   92 	push ix
   0073 DD 21 06 00   [14]   93 	ld ix,#6
   0077 DD 39         [15]   94 	add ix,sp
   0079 16 01         [ 7]   95 	ld d, #SDWRITE
   007B CD 09 01      [17]   96 	call sendcmd
   007E DD 56 00      [19]   97 	ld d,0(ix)
   0081 CD 11 01      [17]   98 	call senddata
   0084 DD 56 01      [19]   99 	ld d,1(ix)
   0087 CD 11 01      [17]  100 	call senddata
   008A DD 56 02      [19]  101 	ld d,2(ix)
   008D CD 11 01      [17]  102 	call senddata
   0090 DD 56 03      [19]  103 	ld d,3(ix)
   0093 CD 11 01      [17]  104 	call senddata
   0096 DD 6E 04      [19]  105 	ld l,4(ix)
   0099 DD 66 05      [19]  106 	ld h,5(ix)
   009C DD 46 00      [19]  107 	ld b,0(ix)
   009F 0E 00         [ 7]  108 	ld c,#0
   00A1                     109 WRLOOP:	
   00A1 56            [ 7]  110 	ld d,(hl)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



   00A2 C5            [11]  111 	push bc
   00A3 CD 11 01      [17]  112 	call senddata
   00A6 C1            [10]  113 	pop bc
   00A7 23            [ 6]  114 	inc hl
   00A8 0B            [ 6]  115 	dec bc
   00A9 78            [ 4]  116 	ld a, b
   00AA B1            [ 4]  117 	or c
   00AB 20 F4         [12]  118 	jr nz, WRLOOP
   00AD DD E1         [14]  119 	pop ix
   00AF C1            [10]  120 	pop bc
   00B0 C9            [10]  121 	ret
                            122 	
   00B1                     123 _sd_format::
   00B1 DD E5         [15]  124 	push ix
   00B3 DD 21 04 00   [14]  125 	ld ix,#4
   00B7 DD 39         [15]  126 	add ix,sp
   00B9 16 05         [ 7]  127 	ld d, #SDFORMAT
   00BB CD 09 01      [17]  128 	call sendcmd
   00BE DD 56 00      [19]  129 	ld d,(ix)
   00C1 CD 11 01      [17]  130 	call senddata
   00C4 DD E1         [14]  131 	pop ix
   00C6 C9            [10]  132 	ret
                            133 	
   00C7                     134 _sd_drvstate::
   00C7 16 07         [ 7]  135 	ld d, #SDDRVSTS
   00C9 CD 09 01      [17]  136 	call sendcmd
   00CC CD 40 01      [17]  137 	call recvdata
   00CF 6A            [ 4]  138 	ld l, d
   00D0 C9            [10]  139 	ret
                            140 	
   00D1                     141 _sd_sendstate::
   00D1 16 06         [ 7]  142 	ld d, #SDSTATUS
   00D3 CD 09 01      [17]  143 	call sendcmd
   00D6 CD 40 01      [17]  144 	call recvdata
   00D9 6A            [ 4]  145 	ld l, d
   00DA C9            [10]  146 	ret
                            147 	
   00DB                     148 _sd_load::
   00DB E5            [11]  149 	push hl
   00DC D5            [11]  150 	push de
   00DD C5            [11]  151 	push bc
   00DE 16 02         [ 7]  152 	ld 	d, #SDREAD
   00E0 CD 09 01      [17]  153 	call sendcmd
   00E3 54            [ 4]  154 	ld	d, h
   00E4 CD 11 01      [17]  155 	call senddata
   00E7 16 00         [ 7]  156 	ld	d, #0
   00E9 CD 11 01      [17]  157 	call senddata
   00EC E1            [10]  158 	pop hl
   00ED 54            [ 4]  159 	ld	d, h
   00EE CD 11 01      [17]  160 	call senddata
   00F1 55            [ 4]  161 	ld  d, l
   00F2 CD 11 01      [17]  162 	call senddata
   00F5 16 03         [ 7]  163 	ld  d, #SDSEND
   00F7 CD 09 01      [17]  164 	call sendcmd
   00FA E1            [10]  165 	pop hl
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



   00FB C1            [10]  166 	pop bc
   00FC 0E 00         [ 7]  167 	ld  c,#0
   00FE                     168 RDLOOPx:
   00FE CD 40 01      [17]  169 	call recvdata
   0101 72            [ 7]  170 	ld (hl), d
   0102 23            [ 6]  171 	inc hl
   0103 0B            [ 6]  172 	dec bc
   0104 78            [ 4]  173 	ld  a, b
   0105 B1            [ 4]  174 	or  c
   0106 20 F6         [12]  175 	jr nz, RDLOOPx
   0108 C9            [10]  176 	ret	
                            177 
   0109                     178 sendcmd:
   0109 06 C0         [ 7]  179     LD	B,#0xC0         	
   010B 0E 02         [ 7]  180     LD	C,#0x02         	
   010D 3E 80         [ 7]  181     LD	A,#0x80         	
   010F ED 79         [12]  182     OUT	(C),A         	
   0111                     183 senddata:	
   0111 06 C0         [ 7]  184     LD	B,#0xC0         	
   0113 0E 02         [ 7]  185     LD	C,#0x02         	
   0115                     186 CHKRFD1:   	
   0115 ED 78         [12]  187 	IN	A,(C)          	
   0117 E6 02         [ 7]  188     AND	#0x02          	
   0119 28 FA         [12]  189     JR	Z,CHKRFD1      	
   011B 0E 02         [ 7]  190     LD	C,#0x02         	
   011D AF            [ 4]  191     XOR	A             	
   011E ED 79         [12]  192     OUT	(C),A         	
   0120 0E 00         [ 7]  193     LD	C,#0x00         	
   0122 ED 51         [12]  194     OUT	(C),D         	
   0124 0E 02         [ 7]  195     LD	C,#0x02         	
   0126 3E 10         [ 7]  196     LD	A,#0x10         	
   0128 ED 79         [12]  197     OUT	(C),A         	
   012A 0E 02         [ 7]  198     LD	C,#0x02         
   012C                     199 CHKDAC2:   	
   012C ED 78         [12]  200 	IN	A,(C)   
   012E E6 04         [ 7]  201     AND	#0x04          	
   0130 28 FA         [12]  202     JR	Z,CHKDAC2      	
   0132 0E 02         [ 7]  203     LD	C,#0x02         
   0134 AF            [ 4]  204     XOR	A             
   0135 ED 79         [12]  205     OUT	(C),A         	
   0137 0E 02         [ 7]  206     LD	C,#0x02         
   0139                     207 CHKDAC3:   	
   0139 ED 78         [12]  208 	IN	A,(C)          
   013B E6 04         [ 7]  209     AND	#0x04          	
   013D 20 FA         [12]  210     JR	NZ,CHKDAC3     	
   013F C9            [10]  211     RET               
                            212 	
   0140                     213 recvdata:
   0140 C5            [11]  214     PUSH	BC           
   0141 0E 02         [ 7]  215     LD	C,#0x02         	
   0143 06 C0         [ 7]  216     LD	B,#0xC0         	
   0145 3E 20         [ 7]  217     LD	A,#0x20         	
   0147 ED 79         [12]  218     OUT	(C),A         	
   0149 0E 02         [ 7]  219     LD	C,#0x02         	
   014B                     220 CHKDAV0:   	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 5.
Hexadecimal [16-Bits]



   014B ED 78         [12]  221 	IN	A,(C)          	
   014D E6 01         [ 7]  222     AND	#0x01          	
   014F 28 FA         [12]  223     JR	Z,CHKDAV0      	
   0151 0E 02         [ 7]  224     LD	C,#0x02         
   0153 AF            [ 4]  225     XOR	A             	
   0154 ED 79         [12]  226     OUT	(C),A         	
   0156 0E 01         [ 7]  227     LD	C,#0x01         	
   0158 ED 50         [12]  228     IN	D,(C)          	
   015A 0E 02         [ 7]  229     LD	C,#0x02         	
   015C 3E 40         [ 7]  230     LD	A,#0x40         	
   015E ED 79         [12]  231     OUT	(C),A         
   0160 0E 02         [ 7]  232     LD	C,#0x02         	
   0162                     233 CHKDAV1:   	
   0162 ED 78         [12]  234 	IN	A,(C)          	
   0164 E6 01         [ 7]  235     AND	#0x01          	
   0166 20 FA         [12]  236     JR	NZ,CHKDAV1     	
   0168 0E 02         [ 7]  237     LD	C,#0x02         
   016A AF            [ 4]  238     XOR	A             	
   016B ED 79         [12]  239     OUT	(C),A         	
   016D C1            [10]  240     POP	BC            	
   016E C9            [10]  241     RET               	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 6.
Hexadecimal [16-Bits]

Symbol Table

    .__.$$$.=  2710 L   |     .__.ABS.=  0000 G   |     .__.CPU.=  0000 L
    .__.H$L.=  0000 L   |   0 CHECKFDD   000E R   |   0 CHKDAC2    012C R
  0 CHKDAC3    0139 R   |   0 CHKDAV0    014B R   |   0 CHKDAV1    0162 R
  0 CHKRFD1    0115 R   |     CLR2    =  0AD5     |   0 RDLOOP     0062 R
  0 RDLOOPx    00FE R   |     SDCOPY  =  0004     |     SDDRVSTS=  0007 
    SDFORMAT=  0005     |     SDGO    =  000D     |     SDINIT  =  0000 
    SDLDNGO =  0010     |     SDLOAD  =  000E     |     SDNOACT =  000A 
    SDRAMTST=  0008     |     SDRCVE  =  000C     |     SDREAD  =  0002 
    SDSAVE  =  000F     |     SDSEND  =  0003     |     SDSTATUS=  0006 
    SDTRANS1=  000B     |     SDTRANS2=  0009     |     SDWRITE =  0001 
  0 WRLOOP     00A1 R   |   0 _chkfdd    0000 GR  |   0 _sd_drvs   00C7 GR
  0 _sd_form   00B1 GR  |   0 _sd_init   000E GR  |   0 _sd_load   00DB GR
  0 _sd_read   002C GR  |   0 _sd_send   00D1 GR  |   0 _sd_writ   0070 GR
  0 recvdata   0140 R   |   0 sendcmd    0109 R   |   0 senddata   0111 R

ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 7.
Hexadecimal [16-Bits]

Area Table

   0 _CODE      size  16F   flags    0

